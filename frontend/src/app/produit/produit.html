<div class="app-container">
  <header class="navbar">
    <div class="nav-left">
      <div class="logo">
        <img src="assets/logo.png" class="logo-img" />
        <span class="logo-text">Stocki</span>
      </div>
    </div>
    <div class="user-info">
      <img src="assets/user.jpg" />
      <span *ngIf="currentUser">Bonjour {{ currentUser.name }}</span>
      <button class="logout-btn" (click)="logout()">DÃ©connexion</button>
    </div>
  </header>
  <div class="container">
    <aside class="sidebar">
      <ul class="menu">
        <li>
          <a routerLink="/dashboard" class="nav-link">ğŸ“Š Tableau de bord</a>
        </li>
        <li><a routerLink="/magasin" class="nav-link">ğŸª Magasins</a></li>
        <li><a routerLink="/categorie" class="nav-link">ğŸ“‚ CatÃ©gories</a></li>
        <li class="active">
          <a routerLink="/produit" class="nav-link">ğŸ“¦ Produits</a>
        </li>
        <li><a routerLink="/ventes" class="nav-link">ğŸ’° Ventes</a></li>
        <li><a routerLink="/stock" class="nav-link">ğŸ“ˆ Stock</a></li>
        <li><a routerLink="/mouvements" class="nav-link">ğŸ”„ Mouvements</a></li>
      </ul>
    </aside>
    <main class="content">
      <div class="welcome-section" *ngIf="currentUser">
        <h2>Vos Produits, {{ currentUser.name }}</h2>
      </div>
      <div class="loading" *ngIf="isLoading">
        <p>Chargement des produits...</p>
      </div>
      <div class="produit-list" *ngIf="!isLoading">
        <div class="item-row header-row">
          <div class="col name">Nom</div>
          <div class="col code">Code</div>
          <div class="col type">Type</div>
          <div class="col prix">Prix (DT)</div>
          <div class="col adresse">Adresse</div>
          <div class="col actions">
            Actions
            <span class="icon-btn add-btn" (click)="addProduit()" title="Ajouter un produit">â•</span>
          </div>
        </div>
        <div class="item-row" *ngFor="let p of produits">
          <div class="col name">{{ p.nom }}</div>
          <div class="col code">{{ p.code }}</div>
          <div class="col type">{{ p.type }}</div>
          <div class="col prix">{{ p.prix }} DT</div>
          <div class="col adresse">{{ p.adresse }}</div>
          <div class="col actions">
            <span class="icon-btn edit-btn" (click)="editProduit(p)" title="Modifier">âœï¸</span>
            <span class="icon-btn delete-btn" (click)="deleteProduit(p)" title="Supprimer">ğŸ—‘ï¸</span>
          </div>
        </div>
        <div class="no-data" *ngIf="produits.length === 0 && !isLoading">
          Aucun produit trouvÃ©. CrÃ©ez votre premier produit!
        </div>
      </div>
    </main>
  </div>
  <div class="popup-overlay" *ngIf="showEditPopup">
    <div class="popup">
      <h3>{{ selectedProduit?.id === 0 ? 'Ajouter' : 'Modifier' }} le produit</h3>
      <div class="popup-content">
        <div class="form-group">
          <label>Nom:</label>
          <input 
            type="text" 
            [value]="selectedProduit?.nom" 
            #nameInput
            (input)="updateProduitField('nom', nameInput.value)"
            class="form-input"
            placeholder="Entrez le nom"
          >
        </div>
        <div class="form-group">
          <label>Code:</label>
          <input 
            type="text" 
            [value]="selectedProduit?.code" 
            #codeInput
            (input)="updateProduitField('code', codeInput.value)"
            class="form-input"
            placeholder="Entrez le code"
          >
        </div>
        <div class="form-group">
          <label>Type:</label>
          <select 
            #typeSelect
            (change)="updateProduitField('type', typeSelect.value)"
            class="form-select"
          >
            <option value="Vente" [selected]="selectedProduit?.type === 'Vente'">Vente</option>
            <option value="Interne" [selected]="selectedProduit?.type === 'Interne'">Interne</option>
          </select>
        </div>
        <div class="form-group">
          <label>Prix (DT):</label>
          <input 
            type="number" 
            [value]="selectedProduit?.prix" 
            #prixInput
            (input)="updateProduitField('prix', prixInput.value)"
            class="form-input"
            placeholder="Entrez le prix en DT"
            step="0.01"
            min="0"
          >
        </div>
        <div class="form-group">
          <label>Adresse:</label>
          <textarea 
            #adresseTextarea
            (input)="updateProduitField('adresse', adresseTextarea.value)"
            class="form-textarea"
            placeholder="Entrez l'adresse"
          >{{ selectedProduit?.adresse }}</textarea>
        </div>
      </div>
      <div class="popup-actions">
        <button class="btn btn-cancel" (click)="closePopups()">Annuler</button>
        <button class="btn btn-confirm" (click)="confirmEdit()">Confirmer</button>
      </div>
    </div>
  </div>
  <div class="popup-overlay" *ngIf="showDeletePopup">
    <div class="popup">
      <h3>Confirmer la suppression</h3>
      <div class="popup-content">
        <p>ÃŠtes-vous sÃ»r de vouloir supprimer le produit <strong>"{{ selectedProduit?.nom }}"</strong> ?</p>
        <p class="warning-text">Cette action est irrÃ©versible !</p>
      </div>
      <div class="popup-actions">
        <button class="btn btn-cancel" (click)="closePopups()">Annuler</button>
        <button class="btn btn-danger" (click)="confirmDelete()">Supprimer</button>
      </div>
    </div>
  </div>
</div>